import paramiko, os, getpass

ssh = paramiko.SSHClient()
ssh.set_missing_host_key_policy(paramiko.AutoAddPolicy())
ip = input("Enter Devices IP: ")
password = getpass.getpass("root@" + ip + "'s password: ")

ssh.connect(ip, port=22, username='root', password = password)
print("Installing Dependancies")
os.system("scp img4tool_192_iphoneos-arm.deb root@"+ ip + ":img4tool_192_iphoneos-arm.deb")
os.system("scp libssl1.1_1.1.1g_iphoneos-arm.deb root@"+ ip + ":libssl1.1_1.1.1g_iphoneos-arm.deb")
os.system("scp libgeneral_31_iphoneos-arm.deb root@"+ ip + ":libgeneral_31_iphoneos-arm.deb")
os.system("scp libimg4tool0_192_iphoneos-arm.deb root@"+ ip + ":libimg4tool0_192_iphoneos-arm.deb")
os.system("scp libplist3_2.2.0_iphoneos-arm.deb root@"+ ip + ":libplist3_2.2.0_iphoneos-arm.deb")
os.system("ssh root@"+ ip + " dpkg -i libplist3_2.2.0_iphoneos-arm.deb")
os.system("ssh root@"+ ip + " dpkg -i libssl1.1_1.1.1g_iphoneos-arm.deb")
os.system("ssh root@"+ ip + " dpkg -i libgeneral_31_iphoneos-arm.deb")
os.system("ssh root@"+ ip + " dpkg -i libimg4tool0_192_iphoneos-arm.deb")
os.system("ssh root@"+ ip + " dpkg -i img4tool_192_iphoneos-arm.deb")
print("Dumping Ticket from iOS FileSystem")
stdin, stdout, stderr = ssh.exec_command("cat /dev/rdisk1 | dd of=dump.raw bs=256 count=$((0x4000)) &> /dev/null")
print("Converting Dump to Ticket")
os.system("ssh root@"+ ip + " img4tool --convert -s dumped.shsh dump.raw")
print("Copying Dump to machine")
os.system("scp root@"+ ip + ":dumped.shsh dumped.shsh")
